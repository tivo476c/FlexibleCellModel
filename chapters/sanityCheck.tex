\section{DF model validation and simulation analysis} \label{sanitycheck}
%%% TODO: Build bridge from previous chapter 
- we continue by making cell simulations with the DF model. \\
- All of our simulations run in the Julia programming language. 
There, we used the package `DifferentialEquations.jl' with its structure `SDEProblem()' and then solved it with the package inbuilt Euler Maruyama scheme that uses a constant time step size. \\
- in order to place our simulations to existing papers, we aim to compare our simulation results to outcomes from an established cell model from~\cite{Bruna2012}. \\

\subsection{Reference simulations: Bruna and Chapman (2012)}
- The point particle and hard sphere models from~\cite{Bruna2012} were already introduced in the Introduction~\ref{intro}. \\
- We will write down the explicit cell dynamics and first marginals again with all parameters applied.
- The paper~\cite{Bruna2012} analyses these dynamics on the domain 
\[\Omega_{BC} = [-0.5, 0.5]^2,\]
on which $N_{C} = 400$ particles are located. \\

- The point particle dynamic is given by
\begin{equation*}
    \begin{cases}
        \dequ \vec{x}_i(t) = \sqrt{2} \, \dequ \vec{B}_i(t), & \vec{x}_i \in \Omega_{BC}^{\circ}, \\[0.5em]
        \dfrac{\dequ \vec{x}_i(t)}{\dequ t} \cdot \vec{n} = 0, & \vec{x}_i \in \partial \Omega_{BC},
    \end{cases}
\end{equation*}
for $1 \leq i \leq N_C$, where 
\[
    \Omega_{BC}^{\circ} = (-0.5, 0.5)^2
\]
denotes the interior of the domain $\Omega_{BC}$ and $\vec{n}$ is the outer normal vector at the boundary 
\[
    \partial \Omega_{BC} = \{(x,y) \in \Omega | x \in \{-0.5, 0.5\} \lor y \in \{-0.5, 0.5\} \}
\]
of the domain. 
The first equation describes the particle dynamics in the interior of the domain, while the second specifies the reflective boundary condition imposed on the boundary of $\Omega$. \\ 
Equation~\eqref{equ:pointparticle} shows the general first marginal of the point particle model.
In our case, we choose the diffusion coefficient to be $D = 1$ and we do not use an external force field, i.e. $f(\vec{x}) = 0$.
Thus, the first marginal simplifies to
\begin{align}
	\dfrac{\partial \rho (t; \vec{x})}{\partial t} = \Delta_{\vec{x}} \rho(t; \vec{x}) , \quad \vec{x} \in \Omega, \; t>0.
    \label{equ:marginalPP}
\end{align}




- In order to transition to the hard sphere cell model, we introduce the cell diameter $0 < \epsilon \ll 1$. \\
- We recall from the Introduction~\ref{intro} that the hard sphere dynamic is given by
\begin{equation*}
    \begin{cases}
        \dequ \vec{x}_i(t) = \sqrt{2} \, \dequ \vec{B}_i(t), & \vec{x}_i \in \Omega_{BC, \epsilon}^{\circ}, \\[0.5em]
        \dfrac{\dequ \vec{x}_i(t)}{\dequ t} \cdot \vec{n} = 0, & \vec{x}_i \in \partial \Omega_{BC, \epsilon},
    \end{cases}
\end{equation*}
where we again choose $D = 1$ and $f(\vec{x}) = 0$.  \\
- Note, that we are now working on the excluded volume domain $\Omega_{BC, \epsilon}$, defined in Equation~\eqref{equ:excludedVolumeDomain} that excludes areas where two cells would overlap. \\ 
- This domain has a more complex boundary $\partial \Omega_{BC, \epsilon}$ that includes both the outer boundary of the domain $\Omega_{BC}$ and inner boundaries where two cells touch each other. \\  
- Thus, we have much more reflections than in the point particle model. \\
- When computing the first marginal of the hard sphere model, we get Equation~\eqref{equ:hardsphere}.
In our case, this simplifies to
\begin{align}
	\dfrac{\partial \rho}{\partial t} = \Delta_{\vec{x}} \rho + \frac{\pi}{2} (N_C - 1) \epsilon^2 \Delta_{\vec{x}} (\rho^2), \quad \vec{x} \in \Omega, \: t>0 . 
    \label{equ:marginalHSCM}
\end{align}


The initial condition of both models follows a two dimensional normal distribution with the addition that the distance of each cell centre to all others is at least $\epsilon$.  
The used distribution $\mathcal{N}_2 \left( 
\scalebox{0.7}{$\begin{pmatrix} 0 \\ 0 \end{pmatrix}$}, 
\scalebox{0.7}{$\begin{pmatrix} 0.09^2 & 0 \\ 0 & 0.09^2 \end{pmatrix}$}
\right)$ has an integral of one over $\Omega_{BC}$. \\
We can compute this initial condition with Algorithm~\ref{alge:HSCMinitial}. 
The avoidance of cell overlaps by the following algorithm is also illustrated in Figure~\ref{fig:hardsphere}. 
\begin{algorithm} \textbf{Computation of the initial cell system} \label{alge:HSCMinitial}
	\begin{enumerate} 
		\item Generate a point $\vec{x} \sim \mathcal{N}_2 \left( 
        \scalebox{0.7}{$\begin{pmatrix} 0 \\ 0 \end{pmatrix}$}, 
        \scalebox{0.7}{$\begin{pmatrix} 0.09^2 & 0 \\ 0 & 0.09^2 \end{pmatrix}$}
        \right)$. 
		\item If for all already generated centres $\vec{x}_j: \norm[\vec{x} - \vec{x}_j] > \epsilon$ is true, use $\vec{x}$ as the next cell centre, otherwise discard the point and restart with step 1 until $N_{C}$ cell centres are found. 
	\end{enumerate}	
\end{algorithm}


We can see a connection between the two marginal Equations~\eqref{equ:marginalPP} and~\eqref{equ:marginalHSCM} by rewriting the first marginal of the hard sphere model. \\
Let us define a diffusion coefficient 
\[
    D_{\epsilon}(\rho) = 1 + \pi(N_{C}-1)\epsilon^2 \rho 
\]
that depends on the local partical density $p$ and the cell diameter $\epsilon$. 
For the point particles, we have $\epsilon = 0$ and $D_{\epsilon}(\rho) = 1$.
Thus, we can rewrite the first marginal of the point particles to  
\begin{align*}
    \frac{\partial \rho}{\partial t}(t; \vec{x}) = D_{\epsilon}(\rho) \Delta_{\vec{x}} \rho. 
\end{align*}
In the case of the hard spheres, where $\epsilon > 0$, we can compute
\begin{align*}
    \frac{\partial \rho}{\partial t}(\vec{x}_1, t) &= \nabla_{\vec{x}_1} \cdot [D_{\epsilon}(\rho) \nabla_{\vec{x}_1} \rho] \\  
    &= \nabla_{\vec{x}_1} \cdot [(1 + \pi(N_{C}-1)\epsilon^2 \rho) \nabla_{\vec{x}_1} \rho] \\
    &= \nabla_{\vec{x}_1} \cdot [\nabla_{\vec{x}_1} \rho + \pi(N_{C}-1)\epsilon^2 \rho \nabla_{\vec{x}_1} \rho] \\
    &= \nabla_{\vec{x}_1} \cdot [\nabla_{\vec{x}_1} \rho + \pi(N_{C}-1)\epsilon^2 \frac{1}{2}\nabla_{\vec{x}_1} \rho^2] \\
    &= \nabla_{\vec{x}_1} \cdot [\nabla_{\vec{x}_1} (\rho + \frac{\pi}{2}(N_{C}-1)\epsilon^2 \rho^2)] \\
\end{align*}

% \begin{align*}
%     \frac{\partial \rho}{\partial t}(t; \vec{x}) &= D_{\epsilon}(\rho) \Delta_{\vec{x}} \rho \\  
%     &= (1 + \pi(N_{C}-1)\epsilon^2 \rho) \Delta_{\vec{x}} \rho \\
%     &= \nabla_{\vec{x}} \cdot [D_{\epsilon}(\rho) \nabla_{\vec{x}} \rho] \\  
%     &= \nabla_{\vec{x}} \cdot [(1 + \pi(N_{C}-1)\epsilon^2 \rho) \nabla_{\vec{x}} \rho] \\
%     &= \nabla_{\vec{x}} \cdot [\nabla_{\vec{x}} \rho + \pi(N_{C}-1)\epsilon^2 \rho \nabla_{\vec{x}} \rho] \\
%     &= \nabla_{\vec{x}} \cdot [\nabla_{\vec{x}} \rho + \pi(N_{C}-1)\epsilon^2 \frac{1}{2}\nabla_{\vec{x}} \rho^2] \\
%     &= \nabla_{\vec{x}} \cdot [\nabla_{\vec{x}} (\rho + \frac{\pi}{2}(N_{C}-1)\epsilon^2 \rho^2)] \\
%     &= \Delta_{\vec{x}} \rho + \frac{\pi}{2} (N_C - 1) \epsilon^2 \Delta_{\vec{x}} (\rho^2) \\
% \end{align*}
to recover Equation~\ref{equ:marginalHSCM}. \\ 
When considering \( D_\epsilon(\rho) = 1 + \pi(N_{C}-1)\epsilon^2 \rho \) to be the diffusion coefficient, we can conclude that an increase in the number of cells \( N_{C} \), the cell diameter \( \epsilon \), or the local density \( \rho \) leads to an increased diffusion rate of the system.
Overall, we conclude that the bounce effect of the HSCM enhances the diffusion rate of the system's density.

\begin{figure}[h!]
	\centering
    \includegraphics[width=0.8\textwidth]{intro/fig2_BC12.png}
    \caption{
    This figure from~\cite{Bruna2012} contains the following four plots, all of them are shown at time \( t=0.05 \). 
	For all plots, the initial condition is normally distributed with mean $(0,0)^T$ and standard deviation $0.09$. 
    (a) shows the solution of the linear diffusion Equation~\eqref{equ:pointparticle} for point particles. 
    (b) shows the histogram of a Monte Carlo simulation of the point particle model. 
    (c) shows the solution of the non linear diffusion Equation~\eqref{equ:hardsphere} for finite-sized particles. 
    (d) shows the histogram of a Monte Carlo simulation of the hard sphere model. 
    The Monte Carlo simulations used $10^4$ simulation runs each with a time step size of $10^-5$.
	We can see that the hard sphere model in (c) and (d) shows a quicker diffusion rate as the cell concentration in the centrum of the domain has already diffused more compared to the point particle model in (a) and (b). 
    }
    \label{fig:fig2BC12}
\end{figure}

Another evidence of this behaviour is shown in Figure~\cite{fig:fig2BC12} which is originally from~\cite{Bruna2012}. \\
Here, we can see two Monte Carlo simulations. 
A Monte Carlo simulation is a computational technique that uses random sampling to model and analyse complex systems or processes that are difficult to solve analytically. 
It repeatedly generates random inputs according to specified probability distributions and computes the resulting outcomes to estimate quantities like averages, variances, or distributions. \\
In our case, the Monte Carlo simulations are used to track the positions of cell centres over time. 
Each simulation begins from an initial configuration of cells, which is consistently generated using Algorithm~\ref{alge:HSCMinitial}. 
After initialization, the prescribed dynamics - either the point particle model or the hard sphere model - are applied, and the positions of the cell centres are recorded at a fixed time point, $t=0.05$. \\
To visualise the results, we construct heatmaps representing the spatial distribution of cells at the final time. 
This is done by discretizing the domain into a uniform grid of sub squares. 
For each sub square, we count how many cells fall within it across all simulations. 
The resulting counts are normalised by dividing by the total number of cells $N_C$, the number of simulations, and the area of a sub square. This normalisation ensures that the heatmap represents a probability density, satisfying the mass conservation condition: \[\sum\limits_{i \: \in \text{ sub squares}} \text{value}_i \cdot \text{area}_i = 1. \]
This approach provides a smooth estimate of the empirical cell density, allowing direct comparison with the corresponding solutions of the diffusion equations.


\subsection{Reproduction of reference results}
Before running our new dynamics that include cell flexibility, we first want to guarantee that the simulations are running in the correct setup.
Therefore, we started with recreating the Monte Carlo simulation for the point particles. 
We always fixed the color scale to be the same as in~\cite{Bruna2012} in order to gain comparability. 
The simulation parameters are the same as in~\cite{Bruna2012}. \\

Beside of this, all particles moved according to the two dimensional Brownian motion
\begin{center}
		$ \dequ \vec{x}_i(t) = \sqrt{2} \dequ \vec{B}_i(t)$, \hspace{0.5em} $1 \leq i \leq N_{C}$.
\end{center}
% TODO: write more about that its succesful 
Figure~\ref{fig:ppHeatmaps} shows the evolution of the particle density in terms of heatmaps for different time steps. 
The results of our Monte Carlo simulation appear to be in good agreement with those of Bruna and Chapman, suggesting that our approach is robust and accurate.

Next, we consider the HSCM and run the Monte Carlo simulation for a cell diameter of $\epsilon = 0.01$. 
Figure~\ref{fig:sanityCheck} shows the density evolution of the HSCM.

\begin{figure}[h!]
    \centering
    \begin{subfigure}{0.9\textwidth}
        \centering
        \begin{tabular}{ccc}
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0/0.png} &     % soft 0
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0-5/0.png} &   %  mid 0
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard1/0.png} \\    % hard 0

            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0/1.png} &     % soft 
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0-5/1.png} &   %  mid 
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard1/1.png} \\    % hard 

            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0/2.png} &     % soft 2
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0-5/2.png} &   %  mid 2
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard1/2.png} \\    % hard 2

            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0/3.png} &     % soft 3
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0-5/3.png} &   %  mid 3
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard1/3.png} \\    % hard 3

            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0/4.png} &     % soft 4
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0-5/4.png} &   %  mid 4
            \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard1/4.png} \\    % hard 4

            \subcaptionbox{\scriptsize Soft ($h=0$)}{
                \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0/5.png}
            } &
            \subcaptionbox{\scriptsize Mid ($h=0.5$)}{
                \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard0-5/5.png}
            } &
            \subcaptionbox{\scriptsize Hard ($h=1$)}{
                \includegraphics[width=0.25\textwidth]{sanity-check/heatmaps/spheres/hard1/5.png}
            }
        \end{tabular}
    \end{subfigure}%

    \begin{subfigure}{0.8\textwidth}
        \centering
        \includegraphics[width=\textwidth]{sanity-check/heatmaps/colorbar_horizontal.png}
    \end{subfigure}%

    \caption{Heatmaps of a Monte Carlo simulation of the DF cell model with different hardness values at the times $t \in \{0.00, 0.01,\ldots, 0.05\}$. 
    Left column $(a)$ shows hardness $0$, we can see hardness $0.5$ in the middle $(b)$ and hardness $1$ on the right $(c)$.
    We can oberserve that the diffusion rate increases with increasing hardness.} 
	\label{fig:sanityCheck}    
\end{figure}

% TODO:
% - bridge to cross sections 
% - introduce cross sections
% - interprete these 


\begin{figure}[h!]
    \centering
    \begin{tabular}{cc}
        \includegraphics[width=0.45\textwidth]{sanity-check/crosssections/crosssection_t0.00.png} &     
        \includegraphics[width=0.45\textwidth]{sanity-check/crosssections/crosssection_t0.01.png} \\   

        \includegraphics[width=0.45\textwidth]{sanity-check/crosssections/crosssection_t0.02.png} &   
        \includegraphics[width=0.45\textwidth]{sanity-check/crosssections/crosssection_t0.03.png} \\  

        \includegraphics[width=0.45\textwidth]{sanity-check/crosssections/crosssection_t0.04.png} &     
        \includegraphics[width=0.45\textwidth]{sanity-check/crosssections/crosssection_t0.05.png} \\   
    \end{tabular}
    \caption{ 
        This figure shows the evolution of the cross section density for our three Monte Carlo simulations at the sample times $t \in {0, 0.01, \ldots, 0.05}$. 
        Initially, each simulation starts with the same distribution. 
        Note that the scaling of the $y$-axis changes from $[0, 3.5]$ at $t = 0$ to $[0.7, 1.3]$ at $t = 0.05$, indicating diffusion in the density distribution for all hardnesses.
        As the plots show, the higher the hardness, the faster the diffusion for $t > 0$, since we observe a lower density in the middle ($x = 0$) and a higher density near the interval borders for higher hardness values. 
        Thus, the density distribution is already more even for higher hardnesses at $t > 0$.
        } 
	\label{fig:crosssections}    
\end{figure}

% TODO:
% - write overall summery that hardness = 1 has highest diffusion rate and softer particles diffuse slower in our model 


\subsection{Shape deformation check}
% TODO: finish this sub section
% - reference to all figures 
% - write down what they say 
In this subsection, we are going to investigate how much the cells deformed throughout our big monte carlo simulations.
Therefore, we need to introduce a measure of how much a cell is deformed. 
There is already some theory existing on how to measure that for two dimensional figures. 
A basic approach is to study the ratio between cell area and cell perimeter. 
We call that ratio the isoperimetric quotient $\alpha$ of that geometric figure $F$, i.e. 
\[
    \alpha_{F} = \nu \dfrac{area_{F}}{perimeter_{F}^2},  
\]
where $\nu \> 0 $ is a scaling factor which we will define later. \\
There is one 2 dimensional geometric figure that has the largest isoperimetric quotient from all: the circle. 
For a circle of radius $r>0$, we have a area of $area_c = \pi r^2 $ and a perimeter of $perimeter_c = 2 \pi r $. 
Thus, it has an isoperimetric quotient of 
\[
    \alpha_{circle} = \nu \dfrac{\pi r^2}{(2 \pi r)^2} = \nu \dfrac{1}{4 \pi}.
\]
We want to normalise the isoperimetric quotient to always be in the interval $[0,1]$. 
Therefore, we just have to choose $\nu = 4 \pi$.
Since a circle always has a maximum isoperimetric quotient, we have an upper bound of $1$.
It also has $0$ as a lower bound since both the area and perimeter of a geometric figure are always positive. \\ 
These properties are also easy to compute for our DF cells. 
We can use the Shoelace Formula~\ref{prop:Shoelace} for the cell area, and for getting the perimeter, we just have to add up the lengths of all cells. \\ 

We can use this approach to analyse how much our cell shapes changed in our big 

\begin{figure}[h!]
    \centering
    \begin{tabular}{cc}
        \includegraphics[width=0.4\textwidth]{sanity-check/asphericity/asp_3v.png} &     
        \includegraphics[width=0.4\textwidth]{sanity-check/asphericity/asp_4v.png} \\[2em]   

        \includegraphics[width=0.4\textwidth]{sanity-check/asphericity/asp_6v.png} &   
        \includegraphics[width=0.4\textwidth]{sanity-check/asphericity/asp_circle.png} \\  

    \end{tabular}
    \caption{ 
        Examples of DF cells and a circle illustrating their geometric properties. 
        The DF cells are represented as regular polygons with $N_V \in \{3,4,6\}$ vertices. 
        For each case, the cell shape, area, perimeter and asphericity are shown.
        The third DF cell with $N_V = 6$ vertices corresponds to the target DF cell configuration used in our Monte Carlo simulations, exhibiting an asphericity of approximately $\alpha \approx 0.907$. 
        As the number of vertices increases, the asphericity rises, reaching its maximum value of $\alpha = 1.0$ for the circular case.
        } 
	\label{fig:asp_overview}    
\end{figure}


\begin{figure}[h!]
    \centering
    \begin{tabular}{cc}
        \includegraphics[width=0.45\textwidth]{sanity-check/asphericity/asphericity-chart-time1.png} &     
        \includegraphics[width=0.45\textwidth]{sanity-check/asphericity/asphericity-chart-time2.png} \\   

        \includegraphics[width=0.45\textwidth]{sanity-check/asphericity/asphericity-chart-time3.png} &   
        \includegraphics[width=0.45\textwidth]{sanity-check/asphericity/asphericity-chart-time4.png} \\  

        \includegraphics[width=0.45\textwidth]{sanity-check/asphericity/asphericity-chart-time5.png} &     
        \includegraphics[width=0.45\textwidth]{sanity-check/asphericity/asphericity-chart-time6.png} \\   
    \end{tabular}
    \caption{ 
        This figure illustrates how the cell asphericities change in the Monte Carlo simulations for hardnesses $h \in \{0, 0.5, 1\}$. 
        Initially, all cells are in their desired states, as shown in the third picture of Figure~\ref{fig:asp_overview}, having an asphericity of $\alpha \approx 0.907$. 
        For $h = 1$, we can see that all $400$ cells keep their standard asphericity of $\alpha \approx 0.907$, as no cell shape deformation is done in this setting. 
        For the other two simulations, we can see that the cells actually change their shapes, resulting in an asphericity spread in the interval $\alpha \in [0.6, 0.95]$ for the soft model ($h = 0$) and $\alpha \in [0.85, 0.95]$ for the mid hardness model ($h = 0.5$).
        } 
	\label{fig:asp_charts}    
\end{figure}